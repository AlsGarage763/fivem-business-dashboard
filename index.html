<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Business Dashboard</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0; padding: 0;
    background: #f5f7fa;
  }
  /* Center login */
  #login-container {
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    background: #2c3e50;
  }
  #login-form {
    background: white;
    padding: 30px 40px;
    border-radius: 8px;
    box-shadow: 0 0 15px rgba(0,0,0,0.3);
    width: 320px;
  }
  #login-form input {
    width: 100%;
    padding: 10px 12px;
    margin-bottom: 15px;
    font-size: 16px;
    border: 1px solid #ccc;
    border-radius: 4px;
  }
  #login-form button {
    width: 100%;
    padding: 12px;
    background: #27ae60;
    border: none;
    color: white;
    font-weight: bold;
    font-size: 16px;
    border-radius: 4px;
    cursor: pointer;
  }
  #login-form button:hover {
    background: #219150;
  }

  /* Dashboard container hidden initially */
  #dashboard {
    display: none;
    padding: 20px;
  }

  /* Tabs style */
  .tabs {
    display: flex;
    border-bottom: 2px solid #ddd;
    margin-bottom: 15px;
  }
  .tab {
    padding: 10px 20px;
    cursor: pointer;
    user-select: none;
    border-bottom: 3px solid transparent;
    transition: border-color 0.3s;
    font-weight: bold;
    color: #555;
  }
  .tab.active {
    border-color: #27ae60;
    color: #27ae60;
  }

  /* Content sections */
  .tab-content {
    display: none;
  }
  .tab-content.active {
    display: block;
  }

  /* Tables */
  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
  }
  table th, table td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: left;
  }
  table th {
    background: #27ae60;
    color: white;
  }

  /* Forms */
  form {
    margin-bottom: 20px;
  }
  form input, form select {
    padding: 6px 8px;
    margin-right: 10px;
    margin-bottom: 10px;
  }
  form button {
    padding: 8px 15px;
    background: #27ae60;
    border: none;
    color: white;
    cursor: pointer;
    border-radius: 4px;
  }
  form button:hover {
    background: #219150;
  }
  .edit-btn, .delete-btn {
    padding: 5px 8px;
    margin-right: 5px;
    cursor: pointer;
    border: none;
    border-radius: 3px;
    font-size: 14px;
  }
  .edit-btn {
    background: #2980b9;
    color: white;
  }
  .edit-btn:hover {
    background: #1c5980;
  }
  .delete-btn {
    background: #c0392b;
    color: white;
  }
  .delete-btn:hover {
    background: #8a231d;
  }

  /* Profit summary */
  .profit-summary div {
    margin-bottom: 8px;
    font-size: 18px;
  }
</style>
</head>
<body>

<!-- LOGIN FORM -->
<div id="login-container">
  <form id="login-form" autocomplete="off" aria-label="Owner Login Form">
    <h2 style="text-align:center; margin-bottom:20px;">Owner Login</h2>
    <input type="text" id="username" placeholder="Username" required aria-label="Username" />
    <input type="password" id="password" placeholder="Password" required aria-label="Password" />
    <button type="submit">Login</button>
  </form>
</div>

<!-- DASHBOARD -->
<div id="dashboard" aria-live="polite" aria-atomic="true">

  <!-- Tabs -->
  <div class="tabs" role="tablist" aria-label="Dashboard Tabs">
    <div class="tab active" role="tab" tabindex="0" aria-selected="true" data-tab="sales">Sales</div>
    <div class="tab" role="tab" tabindex="-1" aria-selected="false" data-tab="employees">Employees</div>
    <div class="tab" role="tab" tabindex="-1" aria-selected="false" data-tab="expenses">Expenses</div>
    <div class="tab" role="tab" tabindex="-1" aria-selected="false" data-tab="payroll">Payroll</div>
    <div class="tab" role="tab" tabindex="-1" aria-selected="false" data-tab="profit">Profit</div>
  </div>

  <!-- Sales Tab -->
  <section id="sales" class="tab-content active" role="tabpanel" tabindex="0" aria-label="Sales tab content">
    <form id="sales-form" aria-label="Add or edit sales record">
      <input type="month" id="sales-month" required aria-required="true" />
      <input type="number" id="sales-amount" min="0" step="0.01" placeholder="Amount" required aria-required="true" />
      <button type="submit">Add/Update Sale</button>
    </form>
    <table aria-describedby="sales-table-desc">
      <caption id="sales-table-desc">Sales records by month and amount</caption>
      <thead>
        <tr><th>Month</th><th>Amount ($)</th><th>Actions</th></tr>
      </thead>
      <tbody id="sales-table-body"></tbody>
    </table>
  </section>

  <!-- Employees Tab -->
  <section id="employees" class="tab-content" role="tabpanel" tabindex="0" aria-label="Employees tab content">
    <form id="employees-form" aria-label="Add or edit employee record">
      <input type="text" id="emp-name" placeholder="Name" required aria-required="true" />
      <select id="emp-gender" required aria-required="true" aria-label="Gender">
        <option value="" disabled selected>Gender</option>
        <option value="male">Male</option>
        <option value="female">Female</option>
      </select>
      <input type="date" id="emp-hiredate" required aria-required="true" />
      <input type="number" id="emp-logs" min="0" placeholder="Work logs" required aria-required="true" />
      <button type="submit">Add/Update Employee</button>
    </form>
    <table aria-describedby="employees-table-desc">
      <caption id="employees-table-desc">Employee list with details</caption>
      <thead>
        <tr><th>Name</th><th>Gender</th><th>Hire Date</th><th>Work Logs</th><th>Actions</th></tr>
      </thead>
      <tbody id="employees-table-body"></tbody>
    </table>
  </section>

  <!-- Expenses Tab -->
  <section id="expenses" class="tab-content" role="tabpanel" tabindex="0" aria-label="Expenses tab content">
    <form id="expenses-form" aria-label="Add expense record">
      <input type="date" id="expense-date" required aria-required="true" />
      <input type="number" id="expense-amount" min="0" step="0.01" placeholder="Amount" required aria-required="true" />
      <input type="text" id="expense-desc" placeholder="Description" required aria-required="true" />
      <button type="submit">Add Expense</button>
    </form>
    <table aria-describedby="expenses-table-desc">
      <caption id="expenses-table-desc">Expense records</caption>
      <thead>
        <tr><th>Date</th><th>Amount ($)</th><th>Description</th><th>Actions</th></tr>
      </thead>
      <tbody id="expenses-table-body"></tbody>
    </table>
  </section>

  <!-- Payroll Tab -->
  <section id="payroll" class="tab-content" role="tabpanel" tabindex="0" aria-label="Payroll tab content">
    <table aria-describedby="payroll-table-desc">
      <caption id="payroll-table-desc">Payroll calculation</caption>
      <thead>
        <tr><th>Name</th><th>Work Logs</th><th>Pay per Log ($)</th><th>Total Pay ($)</th></tr>
      </thead>
      <tbody id="payroll-table-body"></tbody>
      <tfoot>
        <tr>
          <th colspan="3" style="text-align:right;">Total Payroll:</th>
          <th id="payroll-total">$0.00</th>
        </tr>
      </tfoot>
    </table>
  </section>

  <!-- Profit Tab -->
  <section id="profit" class="tab-content" role="tabpanel" tabindex="0" aria-label="Profit tab content">
    <div class="profit-summary">
      <div>Gross Sales: $<span id="profit-gross">0.00</span></div>
      <div>Total Expenses: $<span id="profit-expenses">0.00</span></div>
      <div>Total Payroll: $<span id="profit-payroll">0.00</span></div>
      <div>Tax (20%): $<span id="profit-tax">0.00</span></div>
      <div><strong>Net Profit: $<span id="profit-net">0.00</span></strong></div>
    </div>
  </section>

</div>

<script>
(() => {
  // Constants
  const STORAGE_KEYS = {
    sales: 'dashboard_sales',
    employees: 'dashboard_employees',
    expenses: 'dashboard_expenses',
  };
  const TAX_RATE = 0.2;

  // Cached DOM elements
  const loginForm = document.getElementById('login-form');
  const loginContainer = document.getElementById('login-container');
  const dashboard = document.getElementById('dashboard');

  const tabs = document.querySelectorAll('.tab');
  const tabContents = document.querySelectorAll('.tab-content');

  // Sales
  const salesForm = document.getElementById('sales-form');
  const salesTableBody = document.getElementById('sales-table-body');

  // Employees
  const employeesForm = document.getElementById('employees-form');
  const employeesTableBody = document.getElementById('employees-table-body');

  // Expenses
  const expensesForm = document.getElementById('expenses-form');
  const expensesTableBody = document.getElementById('expenses-table-body');

  // Payroll
  const payrollTableBody = document.getElementById('payroll-table-body');
  const payrollTotalElem = document.getElementById('payroll-total');

  // Profit
  const profitGrossElem = document.getElementById('profit-gross');
  const profitExpensesElem = document.getElementById('profit-expenses');
  const profitPayrollElem = document.getElementById('profit-payroll');
  const profitTaxElem = document.getElementById('profit-tax');
  const profitNetElem = document.getElementById('profit-net');

  // Data stores
  let sales = [];
  let employees = [];
  let expenses = [];

  // For editing employees
  let editingEmployeeId = null;

  // UTILITIES
  function saveData(key, data) {
    localStorage.setItem(key, JSON.stringify(data));
  }
  function loadData(key) {
    const data = localStorage.getItem(key);
    return data ? JSON.parse(data) : [];
  }
  function formatMoney(num) {
    return num.toFixed(2);
  }

  // TAB SWITCHING
  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      setActiveTab(tab.dataset.tab);
    });
    tab.addEventListener('keydown', e => {
      if(e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        setActiveTab(tab.dataset.tab);
      }
    });
  });
  function setActiveTab(tabName) {
    tabs.forEach(t => {
      const isActive = t.dataset.tab === tabName;
      t.classList.toggle('active', isActive);
      t.setAttribute('aria-selected', isActive);
      t.tabIndex = isActive ? 0 : -1;
    });
    tabContents.forEach(tc => {
      tc.classList.toggle('active', tc.id === tabName);
    });
  }

  // --- SALES ---
  function renderSales() {
    salesTableBody.innerHTML = '';
    sales.sort((a,b) => a.month.localeCompare(b.month)).forEach(({month, amount}) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${month}</td>
        <td>$${formatMoney(amount)}</td>
        <td>
          <button class="edit-btn" aria-label="Edit sale for ${month}">Edit</button>
          <button class="delete-btn" aria-label="Delete sale for ${month}">Delete</button>
        </td>
      `;
      const [editBtn, deleteBtn] = tr.querySelectorAll('button');
      editBtn.onclick = () => {
        document.getElementById('sales-month').value = month;
        document.getElementById('sales-amount').value = amount;
      };
      deleteBtn.onclick = () => {
        if(confirm(`Delete sale record for ${month}?`)) {
          sales = sales.filter(s => s.month !== month);
          saveData(STORAGE_KEYS.sales, sales);
          renderSales();
          updateProfit();
        }
      };
      salesTableBody.appendChild(tr);
    });
  }

  salesForm.addEventListener('submit', e => {
    e.preventDefault();
    const month = document.getElementById('sales-month').value;
    const amount = parseFloat(document.getElementById('sales-amount').value);
    if(!month || isNaN(amount) || amount < 0) return alert('Please enter valid month and positive amount.');

    const idx = sales.findIndex(s => s.month === month);
    if(idx >= 0) {
      sales[idx].amount = amount; // update
    } else {
      sales.push({month, amount});
    }
    saveData(STORAGE_KEYS.sales, sales);
    renderSales();
    updateProfit();
    salesForm.reset();
  });

  // --- EMPLOYEES ---
  function renderEmployees() {
    employeesTableBody.innerHTML = '';
    employees.forEach(({id, name, gender, hireDate, logs}) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${name}</td>
        <td>${gender.charAt(0).toUpperCase() + gender.slice(1)}</td>
        <td>${hireDate}</td>
        <td>${logs}</td>
        <td>
          <button class="edit-btn" aria-label="Edit employee ${name}">Edit</button>
          <button class="delete-btn" aria-label="Delete employee ${name}">Delete</button>
        </td>
      `;
      const [editBtn, deleteBtn] = tr.querySelectorAll('button');
      editBtn.onclick = () => {
        document.getElementById('emp-name').value = name;
        document.getElementById('emp-gender').value = gender;
        document.getElementById('emp-hiredate').value = hireDate;
        document.getElementById('emp-logs').value = logs;
        editingEmployeeId = id;
      };
      deleteBtn.onclick = () => {
        if(confirm(`Delete employee ${name}?`)) {
          employees = employees.filter(emp => emp.id !== id);
          saveData(STORAGE_KEYS.employees, employees);
          renderEmployees();
          updatePayroll();
          updateProfit();
        }
      };
      employeesTableBody.appendChild(tr);
    });
  }

  employeesForm.addEventListener('submit', e => {
    e.preventDefault();
    const name = document.getElementById('emp-name').value.trim();
    const gender = document.getElementById('emp-gender').value;
    const hireDate = document.getElementById('emp-hiredate').value;
    const logs = parseInt(document.getElementById('emp-logs').value, 10);

    if(!name || !gender || !hireDate || isNaN(logs) || logs < 0) {
      return alert('Please fill in all employee fields with valid values.');
    }

    if(editingEmployeeId) {
      // Update existing employee
      const idx = employees.findIndex(e => e.id === editingEmployeeId);
      if(idx >= 0) {
        employees[idx] = {id: editingEmployeeId, name, gender, hireDate, logs};
      }
      editingEmployeeId = null;
    } else {
      // Add new employee
      employees.push({id: Date.now().toString(), name, gender, hireDate, logs});
    }
    saveData(STORAGE_KEYS.employees, employees);
    renderEmployees();
    updatePayroll();
    updateProfit();
    employeesForm.reset();
  });

  // --- EXPENSES ---
  function renderExpenses() {
    expensesTableBody.innerHTML = '';
    expenses.sort((a,b) => b.date.localeCompare(a.date)).forEach(({id, date, amount, description}) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${date}</td>
        <td>$${formatMoney(amount)}</td>
        <td>${description}</td>
        <td>
          <button class="delete-btn" aria-label="Delete expense on ${date}">Delete</button>
        </td>
      `;
      const deleteBtn = tr.querySelector('button.delete-btn');
      deleteBtn.onclick = () => {
        if(confirm(`Delete expense on ${date}?`)) {
          expenses = expenses.filter(exp => exp.id !== id);
          saveData(STORAGE_KEYS.expenses, expenses);
          renderExpenses();
          updateProfit();
        }
      };
      expensesTableBody.appendChild(tr);
    });
  }

  expensesForm.addEventListener('submit', e => {
    e.preventDefault();
    const date = document.getElementById('expense-date').value;
    const amount = parseFloat(document.getElementById('expense-amount').value);
    const description = document.getElementById('expense-desc').value.trim();

    if(!date || isNaN(amount) || amount < 0 || !description) {
      return alert('Please fill all expense fields with valid values.');
    }
    expenses.push({id: Date.now().toString(), date, amount, description});
    saveData(STORAGE_KEYS.expenses, expenses);
    renderExpenses();
    updateProfit();
    expensesForm.reset();
  });

  // --- PAYROLL ---
  function updatePayroll() {
    payrollTableBody.innerHTML = '';
    let totalPayroll = 0;
    employees.forEach(({name, logs}) => {
      const payPerLog = name.toLowerCase() === 'john delporte' ? 1200 : 1000;
      const totalPay = payPerLog * logs;
      totalPayroll += totalPay;
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${name}</td>
        <td>${logs}</td>
        <td>$${formatMoney(payPerLog)}</td>
        <td>$${formatMoney(totalPay)}</td>
      `;
      payrollTableBody.appendChild(tr);
    });
    payrollTotalElem.textContent = `$${formatMoney(totalPayroll)}`;
    return totalPayroll;
  }

  // --- PROFIT ---
  function updateProfit() {
    const grossSales = sales.reduce((sum, s) => sum + s.amount, 0);
    const totalExpenses = expenses.reduce((sum, e) => sum + e.amount, 0);
    const totalPayroll = updatePayroll();

    const taxableIncome = grossSales - totalExpenses - totalPayroll;
    const tax = taxableIncome > 0 ? taxableIncome * TAX_RATE : 0;
    const netProfit = taxableIncome - tax;

    profitGrossElem.textContent = formatMoney(grossSales);
    profitExpensesElem.textContent = formatMoney(totalExpenses);
    profitPayrollElem.textContent = formatMoney(totalPayroll);
    profitTaxElem.textContent = formatMoney(tax);
    profitNetElem.textContent = formatMoney(netProfit);
  }

  // --- LOAD DATA ---
  function loadAllData() {
    sales = loadData(STORAGE_KEYS.sales);
    employees = loadData(STORAGE_KEYS.employees);
    expenses = loadData(STORAGE_KEYS.expenses);
    renderSales();
    renderEmployees();
    renderExpenses();
    updateProfit();
  }

  // --- LOGIN ---
  loginForm.addEventListener('submit', e => {
    e.preventDefault();
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value;

    if (username === 'admin' && password === "Al'sOwners123") {
      loginContainer.style.display = 'none';
      dashboard.style.display = 'block';
      loadAllData();
    } else {
      alert('Invalid username or password');
    }
  });

})();
</script>

</body>
</html>
