<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Business Dashboard</title>
<style>
  /* General Reset */
  * {
    box-sizing: border-box;
  }
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    background: #f5f7fa;
    color: #333;
  }
  /* Container */
  #dashboard {
    max-width: 900px;
    margin: 2em auto;
    padding: 1em;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 0 12px rgba(0,0,0,0.1);
  }
  /* Tabs Navigation */
  .tabnav {
    display: flex;
    border-bottom: 2px solid #eee;
    margin-bottom: 1em;
  }
  .tabnav button {
    flex: 1;
    padding: 12px;
    background: #eee;
    border: none;
    border-bottom: 4px solid transparent;
    cursor: pointer;
    font-size: 1em;
    font-weight: 600;
    transition: background 0.3s, border-color 0.3s;
  }
  .tabnav button.active {
    background: #fff;
    border-bottom-color: #007bff;
    color: #007bff;
  }
  .tabnav button:hover:not(.active) {
    background: #ddd;
  }

  /* Tab Content */
  .tabcontent {
    display: none;
  }
  .tabcontent.active {
    display: block;
  }

  /* Forms */
  form.form-group {
    margin-bottom: 1.5em;
    display: flex;
    flex-wrap: wrap;
    gap: 1em;
  }
  form.form-group label {
    flex: 1 0 120px;
    align-self: center;
  }
  form.form-group input,
  form.form-group select {
    flex: 2 0 200px;
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 4px;
  }
  form.form-group button {
    padding: 10px 20px;
    background: #007bff;
    border: none;
    border-radius: 4px;
    color: white;
    cursor: pointer;
    font-weight: 600;
    transition: background 0.3s;
  }
  form.form-group button:hover {
    background: #0056b3;
  }

  /* Data tables */
  table.data-table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 1.5em;
  }
  table.data-table th,
  table.data-table td {
    padding: 10px 12px;
    border: 1px solid #ddd;
    text-align: left;
  }
  table.data-table th {
    background: #f0f0f0;
    font-weight: 700;
  }
  /* Delete button */
  button.delete-btn {
    background: #dc3545;
    border: none;
    color: white;
    padding: 5px 12px;
    border-radius: 4px;
    cursor: pointer;
    font-weight: 600;
    transition: background 0.3s;
  }
  button.delete-btn:hover {
    background: #a71d2a;
  }

  /* Login container */
  #login-container {
    max-width: 360px;
    margin: 5em auto;
    padding: 2em;
    background: white;
    border-radius: 8px;
    box-shadow: 0 0 12px rgba(0,0,0,0.1);
  }
  #login-container h2 {
    text-align: center;
    margin-bottom: 1em;
  }
  #login-container form label {
    display: block;
    margin-bottom: 0.3em;
    font-weight: 600;
  }
  #login-container form input {
    width: 100%;
    padding: 10px;
    margin-bottom: 1.2em;
    border: 1px solid #ccc;
    border-radius: 4px;
  }
  #login-container form button {
    width: 100%;
    padding: 12px;
    background: #007bff;
    border: none;
    border-radius: 6px;
    color: white;
    font-weight: 700;
    cursor: pointer;
    transition: background 0.3s;
  }
  #login-container form button:hover {
    background: #0056b3;
  }

  /* Profit tab specific styles */
  #tax-form {
    margin-bottom: 1em;
    display: flex;
    align-items: center;
  }
  #tax-form label {
    font-weight: 600;
  }
  #tax-input {
    margin-left: 8px;
    width: 80px;
    padding: 6px 10px;
    border: 1px solid #ccc;
    border-radius: 4px;
  }
  #tax-display {
    margin-left: 12px;
    font-weight: 700;
    min-width: 40px;
  }
</style>
</head>
<body>

<!-- LOGIN -->
<div id="login-container">
  <h2>Owner Login</h2>
  <form id="login-form">
    <label for="username">Username</label>
    <input type="text" id="username" autocomplete="username" required />
    <label for="password">Password</label>
    <input type="password" id="password" autocomplete="current-password" required />
    <button type="submit">Login</button>
  </form>
</div>

<!-- DASHBOARD -->
<div id="dashboard" style="display:none;">
  <nav class="tabnav" role="tablist" aria-label="Dashboard Tabs">
    <button class="tablinks active" data-tab="sales-tab" role="tab" aria-selected="true" tabindex="0">Sales</button>
    <button class="tablinks" data-tab="employees-tab" role="tab" aria-selected="false" tabindex="-1">Employees</button>
    <button class="tablinks" data-tab="payroll-tab" role="tab" aria-selected="false" tabindex="-1">Payroll</button>
    <button class="tablinks" data-tab="expenses-tab" role="tab" aria-selected="false" tabindex="-1">Expenses</button>
    <button class="tablinks" data-tab="profit-tab" role="tab" aria-selected="false" tabindex="-1">Profit</button>
  </nav>

  <!-- SALES TAB -->
  <div id="sales-tab" class="tabcontent active" role="tabpanel" tabindex="0">
    <form id="sales-form" class="form-group" aria-label="Add Sales">
      <label for="sale-month">Month (YYYY-MM)</label>
      <input type="month" id="sale-month" required />
      <label for="sale-amount">Amount ($)</label>
      <input type="number" id="sale-amount" min="0" step="0.01" required />
      <button type="submit">Add Sale</button>
    </form>
    <table class="data-table" aria-label="Sales Data">
      <thead>
        <tr><th>Month</th><th>Amount</th><th>Action</th></tr>
      </thead>
      <tbody id="sales-table-body"></tbody>
    </table>
  </div>

  <!-- EMPLOYEES TAB -->
  <div id="employees-tab" class="tabcontent" role="tabpanel" tabindex="0">
    <form id="employees-form" class="form-group" aria-label="Add Employee">
      <label for="employee-name">Name</label>
      <input type="text" id="employee-name" required />
      <label for="employee-hire-date">Hire Date</label>
      <input type="date" id="employee-hire-date" required />
      <label for="employee-gender">Gender</label>
      <select id="employee-gender" required>
        <option value="">Select</option>
        <option value="Male">Male</option>
        <option value="Female">Female</option>
      </select>
      <label for="employee-logs">Logs</label>
      <input type="number" id="employee-logs" min="0" step="1" required />
      <button type="submit">Add Employee</button>
    </form>
    <table class="data-table" aria-label="Employees Data">
      <thead>
        <tr><th>Name</th><th>Hire Date</th><th>Gender</th><th>Logs</th><th>Action</th></tr>
      </thead>
      <tbody id="employees-table-body"></tbody>
    </table>
  </div>

  <!-- PAYROLL TAB -->
  <div id="payroll-tab" class="tabcontent" role="tabpanel" tabindex="0">
    <table class="data-table" aria-label="Payroll Data">
      <thead>
        <tr><th>Name</th><th>Logs</th><th>Pay Per Log ($)</th><th>Total Pay ($)</th></tr>
      </thead>
      <tbody id="payroll-table-body"></tbody>
      <tfoot>
        <tr><th colspan="3" style="text-align:right;">Total Payroll</th><th id="payroll-total">$0.00</th></tr>
      </tfoot>
    </table>
  </div>

  <!-- EXPENSES TAB -->
  <div id="expenses-tab" class="tabcontent" role="tabpanel" tabindex="0">
    <form id="expenses-form" class="form-group" aria-label="Add Expense">
      <label for="expense-month">Month (YYYY-MM)</label>
      <input type="month" id="expense-month" required />
      <label for="expense-amount">Amount ($)</label>
      <input type="number" id="expense-amount" min="0" step="0.01" required />
      <button type="submit">Add Expense</button>
    </form>
    <table class="data-table" aria-label="Expenses Data">
      <thead>
        <tr><th>Month</th><th>Amount</th><th>Action</th></tr>
      </thead>
      <tbody id="expenses-table-body"></tbody>
    </table>
  </div>

  <!-- PROFIT TAB -->
  <div id="profit-tab" class="tabcontent" role="tabpanel" tabindex="0">
    <form id="tax-form" aria-label="Tax Input">
      <label for="tax-input">Tax %:</label>
      <input type="number" id="tax-input" min="0" max="100" step="0.1" value="30" aria-describedby="tax-display" />
      <span id="tax-display">30%</span>
    </form>
    <p><strong>Total Sales:</strong> $<span id="total-sales">0.00</span></p>
    <p><strong>Total Payroll:</strong> $<span id="total-payroll">0.00</span></p>
    <p><strong>Total Expenses:</strong> $<span id="total-expenses">0.00</span></p>
    <p><strong>Profit After Tax:</strong> $<span id="profit-after-tax">0.00</span></p>
  </div>
</div>

<script>
(() => {
  // ======= Constants =======
  const VALID_USERNAME = "admin";
  const VALID_PASSWORD = "Al'sOwners123";

  // ======= Elements =======
  const loginContainer = document.getElementById("login-container");
  const loginForm = document.getElementById("login-form");
  const usernameInput = document.getElementById("username");
  const passwordInput = document.getElementById("password");
  const dashboard = document.getElementById("dashboard");

  const tabs = dashboard.querySelectorAll(".tablinks");
  const tabContents = dashboard.querySelectorAll(".tabcontent");

  // --- SALES ---
  const salesForm = document.getElementById("sales-form");
  const saleMonthInput = document.getElementById("sale-month");
  const saleAmountInput = document.getElementById("sale-amount");
  const salesTableBody = document.getElementById("sales-table-body");

  // --- EMPLOYEES ---
  const employeesForm = document.getElementById("employees-form");
  const employeeNameInput = document.getElementById("employee-name");
  const employeeHireDateInput = document.getElementById("employee-hire-date");
  const employeeGenderInput = document.getElementById("employee-gender");
  const employeeLogsInput = document.getElementById("employee-logs");
  const employeesTableBody = document.getElementById("employees-table-body");

  // --- PAYROLL ---
  const payrollTableBody = document.getElementById("payroll-table-body");
  const payrollTotalDisplay = document.getElementById("payroll-total");

  // --- EXPENSES ---
  const expensesForm = document.getElementById("expenses-form");
  const expenseMonthInput = document.getElementById("expense-month");
  const expenseAmountInput = document.getElementById("expense-amount");
  const expensesTableBody = document.getElementById("expenses-table-body");

  // --- PROFIT ---
  const taxInput = document.getElementById("tax-input");
  const taxDisplay = document.getElementById("tax-display");
  const totalSalesDisplay = document.getElementById("total-sales");
  const totalPayrollDisplay = document.getElementById("total-payroll");
  const totalExpensesDisplay = document.getElementById("total-expenses");
  const profitAfterTaxDisplay = document.getElementById("profit-after-tax");

  // ======= Data Storage Keys =======
  const SALES_KEY = "business_dashboard_sales";
  const EMPLOYEES_KEY = "business_dashboard_employees";
  const EXPENSES_KEY = "business_dashboard_expenses";
  const TAX_KEY = "business_dashboard_tax";

  // ======= Data =======
  let sales = [];
  let employees = [];
  let expenses = [];
  let taxPercent = 30;

  // ======= Utility Functions =======
  function saveToStorage(key, data) {
    localStorage.setItem(key, JSON.stringify(data));
  }
  function loadFromStorage(key) {
    const raw = localStorage.getItem(key);
    return raw ? JSON.parse(raw) : [];
  }

  function formatCurrency(num) {
    return num.toLocaleString(undefined, { style: 'currency', currency: 'USD' });
  }

  // ======= Login Logic =======
  loginForm.addEventListener("submit", e => {
    e.preventDefault();
    const user = usernameInput.value.trim();
    const pass = passwordInput.value;

    if (user === VALID_USERNAME && pass === VALID_PASSWORD) {
      loginContainer.style.display = "none";
      dashboard.style.display = "block";
      initDashboard();
    } else {
      alert("Invalid username or password.");
    }
  });

  // ======= Tab Switching Logic =======
  tabs.forEach(tab => {
    tab.addEventListener("click", () => {
      activateTab(tab);
    });
  });

  function activateTab(selectedTab) {
    tabs.forEach(tab => {
      tab.classList.remove("active");
      tab.setAttribute("aria-selected", "false");
      tab.tabIndex = -1;
    });
    tabContents.forEach(content => {
      content.classList.remove("active");
    });

    selectedTab.classList.add("active");
    selectedTab.setAttribute("aria-selected", "true");
    selectedTab.tabIndex = 0;

    const tabId = selectedTab.getAttribute("data-tab");
    document.getElementById(tabId).classList.add("active");
    document.getElementById(tabId).focus();
  }

  // ======= Sales Logic =======
  salesForm.addEventListener("submit", e => {
    e.preventDefault();
    const month = saleMonthInput.value;
    const amount = parseFloat(saleAmountInput.value);
    if (!month || isNaN(amount) || amount < 0) return alert("Please enter valid sales data.");

    // Check for duplicate month sales, update if exists
    const existingIndex = sales.findIndex(s => s.month === month);
    if (existingIndex !== -1) {
      sales[existingIndex].amount = amount;
    } else {
      sales.push({ month, amount });
    }
    saveToStorage(SALES_KEY, sales);
    renderSales();
    updateProfitTab();
    salesForm.reset();
  });

  function renderSales() {
    salesTableBody.innerHTML = "";
    // Sort sales by month ascending
    sales.sort((a,b) => a.month.localeCompare(b.month));
    sales.forEach(({month, amount}, i) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${month}</td>
        <td>${formatCurrency(amount)}</td>
        <td><button class="delete-btn" data-index="${i}" aria-label="Delete sales for ${month}">Delete</button></td>
      `;
      salesTableBody.appendChild(tr);
    });
  }
  salesTableBody.addEventListener("click", e => {
    if (e.target.classList.contains("delete-btn")) {
      const idx = +e.target.dataset.index;
      sales.splice(idx, 1);
      saveToStorage(SALES_KEY, sales);
      renderSales();
      updateProfitTab();
    }
  });

  // ======= Employees Logic =======
  employeesForm.addEventListener("submit", e => {
    e.preventDefault();
    const name = employeeNameInput.value.trim();
    const hireDate = employeeHireDateInput.value;
    const gender = employeeGenderInput.value;
    const logs = parseInt(employeeLogsInput.value, 10);
    if (!name || !hireDate || !gender || isNaN(logs) || logs < 0) return alert("Please enter valid employee data.");

    // Prevent duplicate employee name
    if (employees.some(emp => emp.name.toLowerCase() === name.toLowerCase())) {
      return alert("Employee with this name already exists.");
    }

    employees.push({ name, hireDate, gender, logs });
    saveToStorage(EMPLOYEES_KEY, employees);
    renderEmployees();
    renderPayroll();
    updateProfitTab();
    employeesForm.reset();
  });

  function renderEmployees() {
    employeesTableBody.innerHTML = "";
    employees.forEach(({name, hireDate, gender, logs}, i) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${name}</td>
        <td>${hireDate}</td>
        <td>${gender}</td>
        <td>${logs}</td>
        <td><button class="delete-btn" data-index="${i}" aria-label="Delete employee ${name}">Delete</button></td>
      `;
      employeesTableBody.appendChild(tr);
    });
  }
  employeesTableBody.addEventListener("click", e => {
    if (e.target.classList.contains("delete-btn")) {
      const idx = +e.target.dataset.index;
      employees.splice(idx, 1);
      saveToStorage(EMPLOYEES_KEY, employees);
      renderEmployees();
      renderPayroll();
      updateProfitTab();
    }
  });

  // ======= Payroll Logic =======
  function renderPayroll() {
   function renderPayroll() {
  payrollTableBody.innerHTML = "";
  const defaultPayPerLog = 1000;
  const specialEmployee = "John Delporte";
  const specialPayPerLog = 1200;
  let totalPayroll = 0;

  employees.forEach(({name, logs}) => {
    const payPerLog = (name === specialEmployee) ? specialPayPerLog : defaultPayPerLog;
    const totalPay = logs * payPerLog;
    totalPayroll += totalPay;
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${name}</td>
      <td>${logs}</td>
      <td>${formatCurrency(payPerLog)}</td>
      <td>${formatCurrency(totalPay)}</td>
    `;
    payrollTableBody.appendChild(tr);
  });
  payrollTotalDisplay.textContent = formatCurrency(totalPayroll);
}


  // ======= Expenses Logic =======
  expensesForm.addEventListener("submit", e => {
    e.preventDefault();
    const month = expenseMonthInput.value;
    const amount = parseFloat(expenseAmountInput.value);
    if (!month || isNaN(amount) || amount < 0) return alert("Please enter valid expense data.");

    // Check duplicate month for expenses and update
    const existingIndex = expenses.findIndex(exp => exp.month === month);
    if (existingIndex !== -1) {
      expenses[existingIndex].amount = amount;
    } else {
      expenses.push({ month, amount });
    }
    saveToStorage(EXPENSES_KEY, expenses);
    renderExpenses();
    updateProfitTab();
    expensesForm.reset();
  });

  function renderExpenses() {
    expensesTableBody.innerHTML = "";
    expenses.sort((a,b) => a.month.localeCompare(b.month));
    expenses.forEach(({month, amount}, i) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${month}</td>
        <td>${formatCurrency(amount)}</td>
        <td><button class="delete-btn" data-index="${i}" aria-label="Delete expense for ${month}">Delete</button></td>
      `;
      expensesTableBody.appendChild(tr);
    });
  }
  expensesTableBody.addEventListener("click", e => {
    if (e.target.classList.contains("delete-btn")) {
      const idx = +e.target.dataset.index;
      expenses.splice(idx, 1);
      saveToStorage(EXPENSES_KEY, expenses);
      renderExpenses();
      updateProfitTab();
    }
  });

  // ======= Profit Tab Logic =======
  function updateProfitTab() {
    const totalSales = sales.reduce((sum, s) => sum + s.amount, 0);
    const totalPayroll = employees.reduce((sum, emp) => sum + (emp.logs * 9.75), 0);
    const totalExpenses = expenses.reduce((sum, e) => sum + e.amount, 0);

    totalSalesDisplay.textContent = totalSales.toFixed(2);
    totalPayrollDisplay.textContent = totalPayroll.toFixed(2);
    totalExpensesDisplay.textContent = totalExpenses.toFixed(2);

    const taxableAmount = totalSales - totalPayroll - totalExpenses;
    const tax = taxableAmount * (taxPercent / 100);
    const profitAfterTax = taxableAmount - tax;

    profitAfterTaxDisplay.textContent = profitAfterTax.toFixed(2);
  }

  taxInput.addEventListener("input", () => {
    let val = parseFloat(taxInput.value);
    if (isNaN(val) || val < 0) val = 0;
    if (val > 100) val = 100;
    taxPercent = val;
    taxInput.value = val.toFixed(1);
    taxDisplay.textContent = val.toFixed(1) + "%";
    localStorage.setItem(TAX_KEY, val);
    updateProfitTab();
  });

  // ======= Initialization =======
  function initDashboard() {
    // Load from storage
    sales = loadFromStorage(SALES_KEY);
    employees = loadFromStorage(EMPLOYEES_KEY);
    expenses = loadFromStorage(EXPENSES_KEY);
    const savedTax = localStorage.getItem(TAX_KEY);
    taxPercent = savedTax !== null ? parseFloat(savedTax) : 30;
    taxInput.value = taxPercent.toFixed(1);
    taxDisplay.textContent = taxPercent.toFixed(1) + "%";

    // Render all data
    renderSales();
    renderEmployees();
    renderPayroll();
    renderExpenses();
    updateProfitTab();
  }
})();
</script>
</body>
</html>
