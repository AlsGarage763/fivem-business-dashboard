<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Business Dashboard</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0; padding: 0;
    background: #f0f2f5;
  }
  #login-container, #dashboard {
    max-width: 900px;
    margin: 40px auto;
    padding: 20px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 0 10px #aaa;
  }
  #dashboard {
    display: none;
  }
  h2 {
    margin-top: 0;
  }
  form {
    margin-bottom: 20px;
  }
  label {
    display: block;
    margin-top: 10px;
    font-weight: bold;
  }
  input, select, button {
    padding: 8px;
    width: 100%;
    max-width: 300px;
    margin-top: 5px;
    border: 1px solid #ccc;
    border-radius: 4px;
  }
  button {
    background-color: #4CAF50;
    color: white;
    border: none;
    cursor: pointer;
    width: auto;
    margin-top: 15px;
  }
  button:hover {
    background-color: #45a049;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
  }
  th, td {
    padding: 10px;
    border-bottom: 1px solid #ddd;
    text-align: left;
  }
  th {
    background-color: #f7f7f7;
  }
  .delete-btn {
    background: #e74c3c;
    border: none;
    color: white;
    cursor: pointer;
    padding: 6px 12px;
    border-radius: 4px;
  }
  .delete-btn:hover {
    background: #c0392b;
  }
  /* Tabs */
  .tab {
    overflow: hidden;
    border-bottom: 1px solid #ccc;
    margin-bottom: 20px;
  }
  .tab button {
    background-color: inherit;
    border: none;
    outline: none;
    cursor: pointer;
    padding: 14px 20px;
    transition: 0.3s;
    font-size: 16px;
    border-bottom: 3px solid transparent;
  }
  .tab button.active {
    border-bottom: 3px solid #4CAF50;
    font-weight: bold;
  }
  .tabcontent {
    display: none;
  }
  .tabcontent.active {
    display: block;
  }
  /* Profit tab styling like others */
  #profit-tab p {
    font-size: 1.1em;
    margin: 10px 0;
  }
  #profit-tab form {
    margin-bottom: 15px;
  }
  #profit-tab label {
    font-weight: bold;
  }
  #tax-display {
    margin-left: 10px;
    font-weight: normal;
  }
</style>
</head>
<body>

<div id="login-container" role="main" aria-label="Login form">
  <h2>Login</h2>
  <form id="login-form" aria-describedby="login-instructions">
    <p id="login-instructions">Enter username and password to access the dashboard.</p>
    <label for="username">Username</label>
    <input type="text" id="username" autocomplete="username" required />
    <label for="password">Password</label>
    <input type="password" id="password" autocomplete="current-password" required />
    <button type="submit">Login</button>
  </form>
</div>

<div id="dashboard" role="main" aria-label="Business Dashboard">
  <h2>Business Dashboard</h2>
  <div class="tab" role="tablist" aria-label="Dashboard Sections">
    <button class="tablinks active" data-tab="sales-tab" role="tab" aria-selected="true" tabindex="0">Sales</button>
    <button class="tablinks" data-tab="employees-tab" role="tab" aria-selected="false" tabindex="-1">Employees</button>
    <button class="tablinks" data-tab="payroll-tab" role="tab" aria-selected="false" tabindex="-1">Payroll</button>
    <button class="tablinks" data-tab="expenses-tab" role="tab" aria-selected="false" tabindex="-1">Expenses</button>
    <button class="tablinks" data-tab="profit-tab" role="tab" aria-selected="false" tabindex="-1">Profit</button>
  </div>

  <!-- SALES TAB -->
  <div id="sales-tab" class="tabcontent active" role="tabpanel" tabindex="0">
    <form id="sales-form" aria-label="Add Sales">
      <label for="sale-month">Month (YYYY-MM)</label>
      <input type="month" id="sale-month" required />
      <label for="sale-amount">Amount ($)</label>
      <input type="number" id="sale-amount" min="0" step="0.01" required />
      <button type="submit">Add Sale</button>
    </form>
    <table aria-label="Sales Data">
      <thead>
        <tr><th>Month</th><th>Amount</th><th>Action</th></tr>
      </thead>
      <tbody id="sales-table-body"></tbody>
    </table>
  </div>

  <!-- EMPLOYEES TAB -->
  <div id="employees-tab" class="tabcontent" role="tabpanel" tabindex="0">
    <form id="employees-form" aria-label="Add Employee">
      <label for="employee-name">Name</label>
      <input type="text" id="employee-name" required />
      <label for="employee-hire-date">Hire Date</label>
      <input type="date" id="employee-hire-date" required />
      <label for="employee-gender">Gender</label>
      <select id="employee-gender" required>
        <option value="">Select gender</option>
        <option value="Male">Male</option>
        <option value="Female">Female</option>
      </select>
      <label for="employee-logs">Logs Worked</label>
      <input type="number" id="employee-logs" min="0" required />
      <button type="submit">Add Employee</button>
    </form>
    <table aria-label="Employees Data">
      <thead>
        <tr><th>Name</th><th>Hire Date</th><th>Gender</th><th>Logs</th><th>Action</th></tr>
      </thead>
      <tbody id="employees-table-body"></tbody>
    </table>
  </div>

  <!-- PAYROLL TAB -->
  <div id="payroll-tab" class="tabcontent" role="tabpanel" tabindex="0">
    <table aria-label="Payroll Data">
      <thead>
        <tr><th>Name</th><th>Logs</th><th>Pay per Log</th><th>Total Pay</th></tr>
      </thead>
      <tbody id="payroll-table-body"></tbody>
      <tfoot>
        <tr>
          <th colspan="3" style="text-align:right">Total Payroll:</th>
          <th id="payroll-total">$0.00</th>
        </tr>
      </tfoot>
    </table>
  </div>

  <!-- EXPENSES TAB -->
  <div id="expenses-tab" class="tabcontent" role="tabpanel" tabindex="0">
    <form id="expenses-form" aria-label="Add Expense">
      <label for="expense-month">Month (YYYY-MM)</label>
      <input type="month" id="expense-month" required />
      <label for="expense-amount">Amount ($)</label>
      <input type="number" id="expense-amount" min="0" step="0.01" required />
      <button type="submit">Add Expense</button>
    </form>
    <table aria-label="Expenses Data">
      <thead>
        <tr><th>Month</th><th>Amount</th><th>Action</th></tr>
      </thead>
      <tbody id="expenses-table-body"></tbody>
    </table>
  </div>

  <!-- PROFIT TAB -->
  <div id="profit-tab" class="tabcontent" role="tabpanel" tabindex="0">
    <form id="tax-form" aria-label="Tax Input">
      <label for="tax-input">Tax %:</label>
      <input type="number" id="tax-input" min="0" max="100" step="0.1" value="30" aria-describedby="tax-display" />
      <span id="tax-display">30%</span>
    </form>
    <p><strong>Total Sales:</strong> $<span id="total-sales">0.00</span></p>
    <p><strong>Total Payroll:</strong> $<span id="total-payroll">0.00</span></p>
    <p><strong>Total Expenses:</strong> $<span id="total-expenses">0.00</span></p>
    <p><strong>Profit After Tax:</strong> $<span id="profit-after-tax">0.00</span></p>
  </div>
</div>

<script>
(() => {
  // ======= Constants =======
  const VALID_USERNAME = "admin";
  const VALID_PASSWORD = "Al'sOwners123";

  // ======= Elements =======
  const loginContainer = document.getElementById("login-container");
  const loginForm = document.getElementById("login-form");
  const usernameInput = document.getElementById("username");
  const passwordInput = document.getElementById("password");
  const dashboard = document.getElementById("dashboard");

  const tabs = dashboard.querySelectorAll(".tablinks");
  const tabContents = dashboard.querySelectorAll(".tabcontent");

  // --- SALES ---
  const salesForm = document.getElementById("sales-form");
  const saleMonthInput = document.getElementById("sale-month");
  const saleAmountInput = document.getElementById("sale-amount");
  const salesTableBody = document.getElementById("sales-table-body");

  // --- EMPLOYEES ---
  const employeesForm = document.getElementById("employees-form");
  const employeeNameInput = document.getElementById("employee-name");
  const employeeHireDateInput = document.getElementById("employee-hire-date");
  const employeeGenderInput = document.getElementById("employee-gender");
  const employeeLogsInput = document.getElementById("employee-logs");
  const employeesTableBody = document.getElementById("employees-table-body");

  // --- PAYROLL ---
  const payrollTableBody = document.getElementById("payroll-table-body");
  const payrollTotalDisplay = document.getElementById("payroll-total");

  // --- EXPENSES ---
  const expensesForm = document.getElementById("expenses-form");
  const expenseMonthInput = document.getElementById("expense-month");
  const expenseAmountInput = document.getElementById("expense-amount");
  const expensesTableBody = document.getElementById("expenses-table-body");

  // --- PROFIT ---
  const taxInput = document.getElementById("tax-input");
  const taxDisplay = document.getElementById("tax-display");
  const totalSalesDisplay = document.getElementById("total-sales");
  const totalPayrollDisplay = document.getElementById("total-payroll");
  const totalExpensesDisplay = document.getElementById("total-expenses");
  const profitAfterTaxDisplay = document.getElementById("profit-after-tax");

  // ======= Data Storage Keys =======
  const SALES_KEY = "business_dashboard_sales";
  const EMPLOYEES_KEY = "business_dashboard_employees";
  const EXPENSES_KEY = "business_dashboard_expenses";
  const TAX_KEY = "business_dashboard_tax";

  // ======= Data =======
  let sales = [];
  let employees = [];
  let expenses = [];
  let taxPercent = 30;

  // ======= Utility Functions =======
  function saveToStorage(key, data) {
    localStorage.setItem(key, JSON.stringify(data));
  }
  function loadFromStorage(key) {
    const raw = localStorage.getItem(key);
    return raw ? JSON.parse(raw) : [];
  }

  function formatCurrency(num) {
    return num.toLocaleString(undefined, { style: 'currency', currency: 'USD' });
  }

  // ======= Login Logic =======
  loginForm.addEventListener("submit", e => {
    e.preventDefault();
    const user = usernameInput.value.trim();
    const pass = passwordInput.value;

    if (user === VALID_USERNAME && pass === VALID_PASSWORD) {
      loginContainer.style.display = "none";
      dashboard.style.display = "block";
      initDashboard();
      // Activate first tab on login
      activateTab(tabs[0]);
    } else {
      alert("Invalid username or password.");
    }
  });

  // ======= Tab Switching Logic =======
  tabs.forEach(tab => {
    tab.addEventListener("click", () => {
      activateTab(tab);
    });
  });

  function activateTab(selectedTab) {
    tabs.forEach(tab => {
      tab.classList.remove("active");
      tab.setAttribute("aria-selected", "false");
      tab.tabIndex = -1;
    });
    tabContents.forEach(content => {
      content.classList.remove("active");
    });

    selectedTab.classList.add("active");
    selectedTab.setAttribute("aria-selected", "true");
    selectedTab.tabIndex = 0;

    const tabId = selectedTab.getAttribute("data-tab");
    document.getElementById(tabId).classList.add("active");
    document.getElementById(tabId).focus();
  }

  // ======= Sales Logic =======
  salesForm.addEventListener("submit", e => {
    e.preventDefault();
    const month = saleMonthInput.value;
    const amount = parseFloat(saleAmountInput.value);
    if (!month || isNaN(amount) || amount < 0) return alert("Please enter valid sales data.");
    sales.push({month, amount});
    saveToStorage(SALES_KEY, sales);
    saleMonthInput.value = "";
    saleAmountInput.value = "";
    renderSales();
    renderProfit();
  });

  function renderSales() {
    salesTableBody.innerHTML = "";
    sales.forEach((sale, idx) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${sale.month}</td>
        <td>${formatCurrency(sale.amount)}</td>
        <td><button class="delete-btn" aria-label="Delete sale for ${sale.month}" data-index="${idx}">Delete</button></td>
      `;
      salesTableBody.appendChild(tr);
    });
  }
  salesTableBody.addEventListener("click", e => {
    if (e.target.classList.contains("delete-btn")) {
      const idx = e.target.getAttribute("data-index");
      sales.splice(idx, 1);
      saveToStorage(SALES_KEY, sales);
      renderSales();
      renderProfit();
    }
  });

  // ======= Employees Logic =======
  employeesForm.addEventListener("submit", e => {
    e.preventDefault();
    const name = employeeNameInput.value.trim();
    const hireDate = employeeHireDateInput.value;
    const gender = employeeGenderInput.value;
    const logs = parseInt(employeeLogsInput.value);

    if (!name || !hireDate || !gender || isNaN(logs) || logs < 0) return alert("Please enter valid employee data.");
    employees.push({name, hireDate, gender, logs});
    saveToStorage(EMPLOYEES_KEY, employees);
    employeeNameInput.value = "";
    employeeHireDateInput.value = "";
    employeeGenderInput.value = "";
    employeeLogsInput.value = "";
    renderEmployees();
    renderPayroll();
    renderProfit();
  });

  function renderEmployees() {
    employeesTableBody.innerHTML = "";
    employees.forEach(({name, hireDate, gender, logs}, idx) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${name}</td>
        <td>${hireDate}</td>
        <td>${gender}</td>
        <td>${logs}</td>
        <td><button class="delete-btn" aria-label="Delete employee ${name}" data-index="${idx}">Delete</button></td>
      `;
      employeesTableBody.appendChild(tr);
    });
  }
  employeesTableBody.addEventListener("click", e => {
    if (e.target.classList.contains("delete-btn")) {
      const idx = e.target.getAttribute("data-index");
      employees.splice(idx, 1);
      saveToStorage(EMPLOYEES_KEY, employees);
      renderEmployees();
      renderPayroll();
      renderProfit();
    }
  });

  // ======= Payroll Logic =======
  function renderPayroll() {
    payrollTableBody.innerHTML = "";
    const defaultPayPerLog = 1000;
    const specialEmployee = "John Delporte";
    const specialPayPerLog = 1200;
    let totalPayroll = 0;

    employees.forEach(({name, logs}) => {
      const payPerLog = (name === specialEmployee) ? specialPayPerLog : defaultPayPerLog;
      const totalPay = logs * payPerLog;
      totalPayroll += totalPay;
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${name}</td>
        <td>${logs}</td>
        <td>${formatCurrency(payPerLog)}</td>
        <td>${formatCurrency(totalPay)}</td>
      `;
      payrollTableBody.appendChild(tr);
    });
    payrollTotalDisplay.textContent = formatCurrency(totalPayroll);
  }

  // ======= Expenses Logic =======
  expensesForm.addEventListener("submit", e => {
    e.preventDefault();
    const month = expenseMonthInput.value;
    const amount = parseFloat(expenseAmountInput.value);
    if (!month || isNaN(amount) || amount < 0) return alert("Please enter valid expense data.");
    expenses.push({month, amount});
    saveToStorage(EXPENSES_KEY, expenses);
    expenseMonthInput.value = "";
    expenseAmountInput.value = "";
    renderExpenses();
    renderProfit();
  });

  function renderExpenses() {
    expensesTableBody.innerHTML = "";
    expenses.forEach((expense, idx) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${expense.month}</td>
        <td>${formatCurrency(expense.amount)}</td>
        <td><button class="delete-btn" aria-label="Delete expense for ${expense.month}" data-index="${idx}">Delete</button></td>
      `;
      expensesTableBody.appendChild(tr);
    });
  }
  expensesTableBody.addEventListener("click", e => {
    if (e.target.classList.contains("delete-btn")) {
      const idx = e.target.getAttribute("data-index");
      expenses.splice(idx, 1);
      saveToStorage(EXPENSES_KEY, expenses);
      renderExpenses();
      renderProfit();
    }
  });

  // ======= Profit Logic =======
  taxInput.addEventListener("input", () => {
    let val = parseFloat(taxInput.value);
    if (isNaN(val) || val < 0) val = 0;
    if (val > 100) val = 100;
    taxInput.value = val;
    taxDisplay.textContent = val + "%";
    taxPercent = val;
    localStorage.setItem(TAX_KEY, taxPercent);
    renderProfit();
  });

  function renderProfit() {
    const totalSales = sales.reduce((sum, s) => sum + s.amount, 0);
    const totalPayroll = employees.reduce((sum, emp) => {
      const payPerLog = (emp.name === "John Delporte") ? 1200 : 1000;
      return sum + emp.logs * payPerLog;
    }, 0);
    const totalExpenses = expenses.reduce((sum, exp) => sum + exp.amount, 0);
    const grossProfit = totalSales - totalExpenses - totalPayroll;
    const taxAmount = grossProfit * (taxPercent / 100);
    const profitAfterTax = grossProfit - taxAmount;

    totalSalesDisplay.textContent = totalSales.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
    totalPayrollDisplay.textContent = totalPayroll.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
    totalExpensesDisplay.textContent = totalExpenses.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
    profitAfterTaxDisplay.textContent = profitAfterTax.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
  }

  // ======= Initialize dashboard after login =======
  function initDashboard() {
    // Load from storage
    sales = loadFromStorage(SALES_KEY);
    employees = loadFromStorage(EMPLOYEES_KEY);
    expenses = loadFromStorage(EXPENSES_KEY);
    const savedTax = localStorage.getItem(TAX_KEY);
    if (savedTax !== null) {
      taxPercent = parseFloat(savedTax);
      if (isNaN(taxPercent)) taxPercent = 30;
      taxInput.value = taxPercent;
      taxDisplay.textContent = taxPercent + "%";
    }

    renderSales();
    renderEmployees();
    renderPayroll();
    renderExpenses();
    renderProfit();
  }

  // ======= Keyboard accessibility for tabs =======
  // Left/Right arrows to move focus and activate tabs
  dashboard.querySelector(".tab").addEventListener("keydown", e => {
    const focusableTabs = Array.from(tabs);
    let idx = focusableTabs.findIndex(t => t === document.activeElement);
    if (idx === -1) return;
    if (e.key === "ArrowRight") {
      idx = (idx + 1) % focusableTabs.length;
      focusableTabs[idx].focus();
      activateTab(focusableTabs[idx]);
      e.preventDefault();
    } else if (e.key === "ArrowLeft") {
      idx = (idx - 1 + focusableTabs.length) % focusableTabs.length;
      focusableTabs[idx].focus();
      activateTab(focusableTabs[idx]);
      e.preventDefault();
    }
  });

})();
</script>

</body>
</html>
